name: windows-release

on: [push, pull_request]

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Install MinGW-w64
        run: |
          curl -L -o mingw-w64.zip https://sourceforge.net/projects/mingw-w64/files/mingw-w64/mingw-w64-release/9.0.0/MinGW-W64-v9.0.0.zip/download
          mkdir mingw-w64
          tar -xf mingw-w64.zip -C mingw-w64 --strip-components=1
          echo "::add-path::$(pwd)/mingw-w64/bin"
      - name: Setup CMake
        run: |
          pacman -Sy --noconfirm mingw-w64-x86_64-cmake
      - name: Configure and Build
        run: |
          mkdir build && cd build
          cmake .. -DCMAKE_BUILD_TYPE=Release -G "MinGW Makefiles"
          cmake --build .
      - name: Run Unit Tests
        run: |
          cd build
          ctest
